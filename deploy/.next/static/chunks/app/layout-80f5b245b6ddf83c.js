(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[177],{283:(e,t,a)=>{"use strict";a.d(t,{A:()=>c,AuthProvider:()=>l});var o=a(5155),r=a(2115);let s=(0,r.createContext)(void 0);function l(e){let{children:t}=e,[a,l]=(0,r.useState)(null),[c,n]=(0,r.useState)(!1),[i,u]=(0,r.useState)(!1);(0,r.useEffect)(()=>{(async()=>{let e=localStorage.getItem("cached_user");e&&l(JSON.parse(e));let t=localStorage.getItem("access_token");if(t)try{let e=await fetch("/api/user/me",{headers:{Authorization:"Bearer ".concat(t)}});if(e.ok){let t=await e.json();t.success?(l(t.data),localStorage.setItem("cached_user",JSON.stringify(t.data))):(localStorage.removeItem("access_token"),localStorage.removeItem("cached_user"),l(null))}else localStorage.removeItem("access_token"),localStorage.removeItem("cached_user"),l(null)}catch(e){console.error("認証の初期化に失敗しました:",e),localStorage.removeItem("access_token"),localStorage.removeItem("cached_user"),l(null)}else localStorage.removeItem("cached_user"),l(null);u(!0)})()},[]);let m=async(e,t)=>{try{let o=await fetch("/api/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e,password:t})}),r=await o.json();if(o.ok&&r.success){let{access_token:e}=r.data;localStorage.setItem("access_token",e);let t=await fetch("/api/user/me",{headers:{Authorization:"Bearer ".concat(e)}});if(t.ok){let e=await t.json();e.success&&(l(e.data),localStorage.setItem("cached_user",JSON.stringify(e.data)))}}else{var a;throw Error((null==(a=r.error)?void 0:a.message)||"ログインに失敗しました")}}catch(e){throw e}},h=async()=>{try{let e=localStorage.getItem("access_token");e&&await fetch("/api/logout",{method:"POST",headers:{Authorization:"Bearer ".concat(e)}})}catch(e){console.error("ログアウト処理でエラーが発生しました:",e)}finally{localStorage.removeItem("access_token"),localStorage.removeItem("cached_user"),l(null)}};return(0,o.jsx)(s.Provider,{value:{user:a,isLoading:c,login:m,logout:h,isAuthenticated:!!a,isInitialized:i},children:t})}function c(){let e=(0,r.useContext)(s);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}},347:()=>{},4147:e=>{e.exports={style:{fontFamily:"'Geist', 'Geist Fallback'",fontStyle:"normal"},className:"__className_5cfdac",variable:"__variable_5cfdac"}},7988:(e,t,a)=>{Promise.resolve().then(a.t.bind(a,4147,23)),Promise.resolve().then(a.t.bind(a,8489,23)),Promise.resolve().then(a.t.bind(a,347,23)),Promise.resolve().then(a.bind(a,283))},8489:e=>{e.exports={style:{fontFamily:"'Geist Mono', 'Geist Mono Fallback'",fontStyle:"normal"},className:"__className_9a8899",variable:"__variable_9a8899"}}},e=>{e.O(0,[896,441,964,358],()=>e(e.s=7988)),_N_E=e.O()}]);